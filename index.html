<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CricketField Scorer - Classic Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #166534; /* Dark Green */
            background-image: url('https://www.transparenttextures.com/patterns/crissxcross.png');
        }
        .font-roboto-slab { font-family: 'Roboto Slab', serif; }
        
        .nav-link {
            position: relative;
            transition: color 0.3s;
            letter-spacing: 0.05em;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #f59e0b; /* Amber */
            transition: width 0.3s ease-in-out;
        }
        .nav-link:hover, .nav-link.active {
            color: #f59e0b;
        }
        .nav-link:hover::after, .nav-link.active::after {
            width: 100%;
        }

        .form-input {
            @apply w-full px-2 py-2 text-gray-800 bg-white border-2 border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-700 focus:border-red-700 transition-all text-center text-2xl font-bold;
        }
        .btn {
            @apply px-8 py-3 font-bold rounded-md transition-all transform hover:scale-105 shadow-lg w-full sm:w-auto uppercase tracking-wider;
        }
        .btn-primary { @apply bg-red-700 hover:bg-red-800 text-white shadow-red-900/30; }
        .btn-secondary { @apply bg-gray-600 hover:bg-gray-700 text-white shadow-gray-500/20; }
        .btn-danger { @apply bg-gray-800 hover:bg-black text-white; }
        
        .section { display: none; }
        .section.active { display: block; }
        
        .player-row input::-webkit-outer-spin-button,
        .player-row input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .player-row input { -moz-appearance: textfield; }
        
        .card {
            background-color: #f8fafc; /* Slate 50 */
            border: 1px solid #e2e8f0; /* Slate 200 */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        
        .dismissal-btn {
            @apply px-3 py-1 text-xs border-2 border-gray-300 text-gray-600 rounded-full cursor-pointer transition-all duration-200 hover:border-red-700 hover:bg-red-100;
        }
        .dismissal-btn.selected {
            @apply bg-red-700 text-white border-red-700 font-bold;
        }
    </style>
</head>
<body class="bg-green-800 text-gray-800">

    <!-- Header -->
    <header class="bg-green-900 shadow-2xl sticky top-0 z-50 border-b-4 border-yellow-400">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <h1 class="text-3xl sm:text-4xl font-roboto-slab font-bold text-white tracking-wider">
                    Cricket Scorer
                </h1>
                <nav class="hidden md:flex space-x-10 text-white font-semibold items-center text-sm uppercase">
                    <a onclick="showSection('home')" class="nav-link active">Home</a>
                    <a onclick="showSection('create-match')" class="nav-link">Create Match</a>
                    <a onclick="showSection('view-prediction')" class="nav-link">View Result</a>
                    <a onclick="showSection('contact')" class="nav-link">Contact</a>
                </nav>
                <button id="mobile-menu-button" class="md:hidden text-white focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-green-900 border-t border-green-800">
            <a onclick="showSection('home', true)" class="block text-white py-4 px-4 hover:bg-yellow-400 hover:text-black transition-colors font-semibold">Home</a>
            <a onclick="showSection('create-match', true)" class="block text-white py-4 px-4 hover:bg-yellow-400 hover:text-black transition-colors font-semibold">Create Match</a>
            <a onclick="showSection('view-prediction', true)" class="block text-white py-4 px-4 hover:bg-yellow-400 hover:text-black transition-colors font-semibold">View Result</a>
            <a onclick="showSection('contact', true)" class="block text-white py-4 px-4 hover:bg-yellow-400 hover:text-black transition-colors font-semibold">Contact</a>
        </div>
    </header>

    <main class="container mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Home Section -->
        <section id="home" class="section active">
            <div class="card rounded-xl p-8 md:p-16 text-center shadow-xl">
                <h2 class="text-5xl md:text-7xl font-roboto-slab font-bold text-gray-800 mb-4">Classic Cricket Scoring</h2>
                <p class="text-lg text-gray-600 max-w-2xl mx-auto mb-8">The simple, elegant way to score your local cricket matches. Enter player stats, see live strike rates, and find the winner. No fuss, just cricket.</p>
                <button onclick="showSection('create-match')" class="btn btn-primary text-lg">Start Scoring</button>
            </div>
        </section>

        <!-- Create Match Section -->
        <section id="create-match" class="section">
             <div class="card p-6 sm:p-8 rounded-xl shadow-xl">
                <h2 class="text-4xl sm:text-5xl font-roboto-slab font-bold text-gray-800 mb-8 border-b-2 border-gray-200 pb-4">Match Setup</h2>
                <div class="grid md:grid-cols-2 gap-x-8 gap-y-6 mb-10">
                    <div>
                        <label for="myTeamName" class="block text-sm font-semibold text-gray-600 mb-2">Your Team Name</label>
                        <input type="text" id="myTeamName" class="form-input !text-left !text-lg !font-normal" placeholder="E.g., Team A">
                    </div>
                    <div>
                        <label for="opponentTeamName" class="block text-sm font-semibold text-gray-600 mb-2">Opponent's Team Name</label>
                        <input type="text" id="opponentTeamName" class="form-input !text-left !text-lg !font-normal" placeholder="E.g., Team B">
                    </div>
                </div>
                <div class="grid lg:grid-cols-2 gap-12">
                    <div class="flex flex-col">
                        <h3 id="myTeamSectionHeader" class="text-3xl font-roboto-slab font-semibold text-gray-800 mb-4">My Team</h3>
                        <div id="myTeamPlayers" class="space-y-4 flex-grow"></div>
                        <div class="mt-4"><button onclick="addPlayer('myTeam')" class="btn btn-secondary text-sm">Add Player</button></div>
                    </div>
                    <div class="flex flex-col">
                        <h3 id="opponentTeamSectionHeader" class="text-3xl font-roboto-slab font-semibold text-gray-800 mb-4">Opponent Team</h3>
                        <div id="opponentTeamPlayers" class="space-y-4 flex-grow"></div>
                        <div class="mt-4"><button onclick="addPlayer('opponentTeam')" class="btn btn-secondary text-sm">Add Player</button></div>
                    </div>
                </div>
                <div class="mt-10 pt-6 border-t-2 border-gray-200 flex flex-col sm:flex-row justify-center items-center gap-4">
                    <button onclick="generateResult()" class="btn btn-primary font-roboto-slab text-xl">Calculate Winner</button>
                    <button onclick="saveMatchData()" class="btn btn-secondary">Save Match</button>
                    <button onclick="clearAllData()" class="btn btn-danger">Clear All</button>
                </div>
             </div>
        </section>

        <!-- View Result Section -->
        <section id="view-prediction" class="section">
            <div class="card p-6 sm:p-8 rounded-xl shadow-xl">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 border-b-2 border-gray-200 pb-4">
                    <h2 class="text-5xl font-roboto-slab font-bold text-gray-800">Match Result</h2>
                    <button id="downloadCsvBtn" onclick="downloadCSV()" class="btn btn-primary mt-4 sm:mt-0 text-sm">Download CSV</button>
                </div>
                <div id="winnerResult" class="hidden text-center bg-blue-600 text-white p-6 rounded-lg mb-8 shadow-xl">
                    <h3 class="text-5xl font-roboto-slab font-bold" id="winnerText"></h3>
                    <p class="font-semibold text-blue-100 mt-2" id="winnerReason"></p>
                </div>
                 <div id="predictionError" class="hidden text-center bg-red-100 border-2 border-red-200 text-red-700 p-4 rounded-md mb-8">
                    <p class="font-bold text-lg">No data found!</p>
                    <p class="text-sm">Please create a match and enter player stats first.</p>
                </div>
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-3xl font-roboto-slab font-semibold text-gray-800 mb-4" id="myTeamResultHeader">My Team Stats</h3>
                        <div class="overflow-x-auto rounded-lg border-2 border-gray-200">
                            <table class="min-w-full text-sm">
                                <thead class="bg-gray-200">
                                    <tr>
                                        <th class="py-3 px-4 text-left font-semibold uppercase text-gray-600">Player</th>
                                        <th class="py-3 px-4 text-left font-semibold uppercase text-gray-600">Dismissal</th>
                                        <th class="py-3 px-4 text-center font-semibold uppercase text-gray-600">R</th>
                                        <th class="py-3 px-4 text-center font-semibold uppercase text-gray-600">B</th>
                                        <th class="py-3 px-4 text-center font-semibold uppercase text-gray-600">SR</th>
                                    </tr>
                                </thead>
                                <tbody id="myTeamResultBody" class="divide-y divide-gray-200 bg-white"></tbody>
                            </table>
                        </div>
                         <div id="myTeamTotals" class="mt-4 font-bold text-right pr-2 text-lg"></div>
                    </div>
                    <div>
                        <h3 class="text-3xl font-roboto-slab font-semibold text-gray-800 mb-4" id="opponentTeamResultHeader">Opponent Team Stats</h3>
                         <div class="overflow-x-auto rounded-lg border-2 border-gray-200">
                             <table class="min-w-full text-sm">
                                <thead class="bg-gray-200">
                                    <tr>
                                        <th class="py-3 px-4 text-left font-semibold uppercase text-gray-600">Player</th>
                                        <th class="py-3 px-4 text-left font-semibold uppercase text-gray-600">Dismissal</th>
                                        <th class="py-3 px-4 text-center font-semibold uppercase text-gray-600">R</th>
                                        <th class="py-3 px-4 text-center font-semibold uppercase text-gray-600">B</th>
                                        <th class="py-3 px-4 text-center font-semibold uppercase text-gray-600">SR</th>
                                    </tr>
                                </thead>
                                <tbody id="opponentTeamResultBody" class="divide-y divide-gray-200 bg-white"></tbody>
                            </table>
                        </div>
                        <div id="opponentTeamTotals" class="mt-4 font-bold text-right pr-2 text-lg"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="section">
            <div class="card p-8 rounded-xl shadow-xl text-center">
                <h2 class="text-5xl font-roboto-slab font-bold text-gray-800 mb-4">Contact Us</h2>
                <p class="text-lg text-gray-600 mb-6">Your feedback is invaluable. Please reach out with questions or suggestions.</p>
                <div class="text-gray-700 text-lg space-y-2">
                    <p><strong>Email:</strong> contact@cricketfield.dev</p>
                    <p><strong>Twitter:</strong> @CFScorer</p>
                </div>
            </div>
        </section>
    </main>
    
    <footer class="text-center py-8 mt-8 border-t border-green-900">
        <p class="text-green-200 text-sm">&copy; 2025 CricketField Scorer. All Rights Reserved.</p>
        <p class="text-green-300 text-xs mt-1">Designed & Developed by Krishnakanth & Sai Kiran</p>
    </footer>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-5 right-5 bg-red-700 text-white px-6 py-3 rounded-lg shadow-lg opacity-0 translate-y-3 transition-all duration-300 font-semibold">
        <p id="toast-message"></p>
    </div>

<script>
    // --- Navigation ---
    const sections = document.querySelectorAll('.section');
    const navLinks = document.querySelectorAll('.nav-link');
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileMenuButton = document.getElementById('mobile-menu-button');

    mobileMenuButton.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
    });
    
    function showSection(sectionId, fromMobile = false) {
        sections.forEach(section => section.classList.remove('active'));
        document.getElementById(sectionId).classList.add('active');
        navLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('onclick').includes(`'${sectionId}'`)) {
                link.classList.add('active');
            }
        });
        if (sectionId === 'view-prediction') displayResults();
        if (fromMobile) mobileMenu.classList.add('hidden');
        window.scrollTo(0, 0);
    }
    
    // --- Toast Notification ---
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toast-message');

    function showToast(message, duration = 3000) {
        toastMessage.textContent = message;
        toast.classList.remove('opacity-0', 'translate-y-3');
        setTimeout(() => {
            toast.classList.add('opacity-0', 'translate-y-3');
        }, duration);
    }

    // --- Player Management ---
    const myTeamPlayersContainer = document.getElementById('myTeamPlayers');
    const opponentTeamPlayersContainer = document.getElementById('opponentTeamPlayers');

    function addPlayer(teamType, player = { name: '', runs: '', balls: '', dismissal: 'Not Out' }) {
        const container = teamType === 'myTeam' ? myTeamPlayersContainer : opponentTeamPlayersContainer;
        if (container.children.length >= 11) {
            showToast('Maximum of 11 players allowed.');
            return;
        }
        const playerIndex = container.children.length + 1;
        const playerDiv = document.createElement('div');
        playerDiv.className = 'player-row bg-white p-4 rounded-lg border border-gray-200 space-y-4 shadow-sm';
        
        const dismissalOptions = ['Not Out', 'Bowled', 'Caught', 'LBW', 'Run Out', 'Stumped', 'Hit Wicket', 'Other'];
        const dismissalButtons = dismissalOptions.map(opt => 
            `<button type="button" class="dismissal-btn ${opt === player.dismissal ? 'selected' : ''}" onclick="selectDismissal(this, '${opt}')">${opt}</button>`
        ).join('');

        playerDiv.innerHTML = `
            <div class="flex justify-between items-start">
                <input type="text" value="${player.name}" class="player-name-input text-xl font-semibold text-gray-800 bg-transparent border-0 border-b-2 border-gray-300 focus:ring-0 focus:border-red-700 rounded-none p-1 flex-grow mr-4" placeholder="Player ${playerIndex} Name">
                <button onclick="removePlayer(this)" class="bg-gray-200 hover:bg-red-200 text-red-700 rounded-full p-2 h-8 w-8 flex items-center justify-center flex-shrink-0 transition-colors">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                 <div class="bg-gray-100 rounded-lg p-3 grid grid-cols-3 gap-2 text-center items-center">
                    <div>
                        <label class="text-sm text-gray-500">Runs</label>
                        <input type="number" value="${player.runs}" class="runs-input form-input !p-0 !bg-transparent !border-0 !rounded-none focus:!ring-0" placeholder="0" oninput="updateStrikeRate(this)">
                    </div>
                    <div>
                        <label class="text-sm text-gray-500">Balls</label>
                        <input type="number" value="${player.balls}" class="balls-input form-input !p-0 !bg-transparent !border-0 !rounded-none focus:!ring-0" placeholder="0" oninput="updateStrikeRate(this)">
                    </div>
                    <div class="border-l border-gray-200">
                        <label class="text-sm text-gray-500 uppercase">SR</label>
                        <span class="strike-rate-display font-roboto-slab font-bold text-3xl text-gray-800 block">0.0</span>
                    </div>
                </div>
                 <div>
                    <label class="text-sm text-gray-600 mb-2 block">Dismissal</label>
                     <div class="dismissal-container flex flex-wrap gap-2" data-dismissal="${player.dismissal}">
                        ${dismissalButtons}
                     </div>
                 </div>
            </div>
        `;
        
        container.appendChild(playerDiv);
        updateStrikeRate(playerDiv.querySelector('.runs-input'));
    }
    
    function selectDismissal(btn, dismissal) {
        const container = btn.parentElement;
        container.querySelectorAll('.dismissal-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        container.dataset.dismissal = dismissal;
    }

    function removePlayer(button) {
        const playerDiv = button.closest('.player-row');
        const container = playerDiv.parentElement;
        if (container.children.length <= 5) {
             showToast('Minimum of 5 players required.');
             return;
        }
        playerDiv.remove();
    }
    
    function updateStrikeRate(inputElement) {
        const playerRow = inputElement.closest('.player-row');
        const runs = parseInt(playerRow.querySelector('.runs-input').value) || 0;
        const balls = parseInt(playerRow.querySelector('.balls-input').value) || 0;
        const srDisplay = playerRow.querySelector('.strike-rate-display');
        srDisplay.textContent = balls > 0 ? `${((runs / balls) * 100).toFixed(1)}` : `0.0`;
    }

    // --- Data Handling ---
    function getTeamData(teamType) {
        const container = teamType === 'myTeam' ? myTeamPlayersContainer : opponentTeamPlayersContainer;
        const nameInput = teamType === 'myTeam' ? document.getElementById('myTeamName') : document.getElementById('opponentTeamName');
        const teamName = nameInput.value.trim() || (teamType === 'myTeam' ? 'My Team' : 'Opponent Team');
        
        let totalRuns = 0, totalBalls = 0;
        const players = Array.from(container.querySelectorAll('.player-row')).map((row, index) => {
            const name = row.querySelector('.player-name-input').value.trim() || `Player ${index + 1}`;
            const runs = parseInt(row.querySelector('.runs-input').value) || 0;
            const balls = parseInt(row.querySelector('.balls-input').value) || 0;
            const dismissal = row.querySelector('.dismissal-container').dataset.dismissal || 'Not Out';
            totalRuns += runs;
            totalBalls += balls;
            return { name, runs, balls, strikeRate: balls > 0 ? (runs / balls) * 100 : 0, dismissal };
        });
        
        return { name: teamName, players, totalRuns, totalBalls, avgStrikeRate: totalBalls > 0 ? (totalRuns / totalBalls) * 100 : 0 };
    }
    
    function saveMatchData() {
        if (!validateInputs()) return;
        localStorage.setItem('cricketMatchData', JSON.stringify({
            myTeam: getTeamData('myTeam'),
            opponentTeam: getTeamData('opponentTeam')
        }));
        showToast('Match data saved successfully!');
    }

    function loadMatchData() {
        const savedData = localStorage.getItem('cricketMatchData');
        myTeamPlayersContainer.innerHTML = '';
        opponentTeamPlayersContainer.innerHTML = '';
        if (savedData) {
            const matchData = JSON.parse(savedData);
            document.getElementById('myTeamName').value = matchData.myTeam.name;
            document.getElementById('opponentTeamName').value = matchData.opponentTeam.name;
            matchData.myTeam.players.forEach(p => addPlayer('myTeam', p));
            matchData.opponentTeam.players.forEach(p => addPlayer('opponentTeam', p));
        } else {
            for (let i = 0; i < 5; i++) {
                addPlayer('myTeam');
                addPlayer('opponentTeam');
            }
        }
    }

    function clearAllData() {
        if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
            localStorage.removeItem('cricketMatchData');
            document.getElementById('myTeamName').value = '';
            document.getElementById('opponentTeamName').value = '';
            loadMatchData();
            showToast('All data has been cleared.');
            showSection('create-match');
        }
    }
    
    function validateInputs() {
        const myTeamPlayerCount = myTeamPlayersContainer.children.length;
        const opponentTeamPlayerCount = opponentTeamPlayersContainer.children.length;

        if (myTeamPlayerCount < 5 || opponentTeamPlayerCount < 5) {
            showToast('Both teams must have at least 5 players.');
            return false;
        }
        let allValid = true;
        document.querySelectorAll('.player-row input[type="number"]').forEach(input => {
            if (input.value && parseInt(input.value) < 0) {
                input.classList.add('!border-red-500');
                allValid = false;
            } else {
                input.classList.remove('!border-red-500');
            }
        });
        if (!allValid) showToast('Runs and balls cannot be negative.');
        return allValid;
    }

    // --- Result Calculation and Display ---
    function generateResult() {
        if (!validateInputs()) return;
        saveMatchData();
        showToast('Result calculated! Check the "View Result" tab.');
        showSection('view-prediction');
    }

    function displayResults() {
        const savedData = localStorage.getItem('cricketMatchData');
        const winnerResultDiv = document.getElementById('winnerResult');
        const predictionErrorDiv = document.getElementById('predictionError');

        if (!savedData) {
            winnerResultDiv.classList.add('hidden');
            predictionErrorDiv.classList.remove('hidden');
            document.getElementById('downloadCsvBtn').classList.add('hidden');
            return;
        }
        
        winnerResultDiv.classList.remove('hidden');
        predictionErrorDiv.classList.add('hidden');
        document.getElementById('downloadCsvBtn').classList.remove('hidden');

        const { myTeam, opponentTeam } = JSON.parse(savedData);
        populateResultTable('myTeam', myTeam);
        populateResultTable('opponentTeam', opponentTeam);
        
        const winnerText = document.getElementById('winnerText');
        const winnerReason = document.getElementById('winnerReason');
        
        if (myTeam.totalRuns > opponentTeam.totalRuns) {
            winnerText.textContent = `${myTeam.name} Won!`;
            winnerReason.textContent = `Final score: ${myTeam.totalRuns} to ${opponentTeam.totalRuns}`;
        } else if (opponentTeam.totalRuns > myTeam.totalRuns) {
            winnerText.textContent = `${opponentTeam.name} Won!`;
            winnerReason.textContent = `Final score: ${opponentTeam.totalRuns} to ${myTeam.totalRuns}`;
        } else {
            winnerText.textContent = `Match Tied!`;
            winnerReason.textContent = `Both teams scored ${myTeam.totalRuns} runs.`;
        }
    }

    function populateResultTable(teamType, teamData) {
        const tableBody = document.getElementById(`${teamType}ResultBody`);
        document.getElementById(`${teamType}ResultHeader`).textContent = `${teamData.name} - Scoreboard`;
        tableBody.innerHTML = '';

        if (teamData.players.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-gray-500">No data.</td></tr>';
            return;
        }
        
        teamData.players.forEach(p => {
            const row = tableBody.insertRow();
            const runsDisplay = p.dismissal === 'Not Out' ? `<span class="text-gray-800">${p.runs}*</span>` : `<span class="text-gray-800">${p.runs}</span>`;
            row.innerHTML = `
                <td class="py-4 px-4 font-semibold text-gray-800">${p.name}</td>
                <td class="py-4 px-4 text-left text-gray-500">${p.dismissal}</td>
                <td class="py-4 px-4 text-center font-bold">${runsDisplay}</td>
                <td class="py-4 px-4 text-center text-gray-500">${p.balls}</td>
                <td class="py-4 px-4 text-center font-semibold text-red-700">${p.strikeRate.toFixed(2)}</td>
            `;
        });
        
        const wickets = teamData.players.filter(p=>p.dismissal !== 'Not Out').length;
        document.getElementById(`${teamType}Totals`).innerHTML = `
            <span class="text-gray-600">Total: <strong class="text-gray-800">${teamData.totalRuns} / ${wickets}</strong></span><br>
            <span class="text-gray-600">Avg SR: <strong class="text-red-700">${teamData.avgStrikeRate.toFixed(2)}</strong></span>
        `;
    }

    function downloadCSV() {
        const savedData = localStorage.getItem('cricketMatchData');
        if (!savedData) return;
        const { myTeam, opponentTeam } = JSON.parse(savedData);
        let csvContent = "data:text/csv;charset=utf-8,Team,Player,Runs,Balls Faced,Strike Rate,Dismissal\n";
        const addTeamToCsv = (team) => {
            team.players.forEach(p => {
                csvContent += `${team.name.replace(/,/g, '')},${p.name.replace(/,/g, '')},${p.runs},${p.balls},${p.strikeRate.toFixed(2)},${p.dismissal}\n`;
            });
            const wickets = team.players.filter(p=>p.dismissal !== 'Not Out').length;
            csvContent += `${team.name} Totals,,${team.totalRuns},${team.totalBalls},${team.avgStrikeRate.toFixed(2)},For ${wickets} Wickets\n\n`;
        };
        addTeamToCsv(myTeam);
        addTeamToCsv(opponentTeam);
        
        const link = document.createElement("a");
        link.setAttribute("href", encodeURI(csvContent));
        link.setAttribute("download", "cricket_match_stats.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    document.addEventListener('DOMContentLoaded', () => {
        loadMatchData();
        // Event listeners for team name input to update headers dynamically
        document.getElementById('myTeamName').addEventListener('input', (e) => {
            document.getElementById('myTeamSectionHeader').textContent = (e.target.value.trim() || 'My Team');
        });
        document.getElementById('opponentTeamName').addEventListener('input', (e) => {
            document.getElementById('opponentTeamSectionHeader').textContent = (e.target.value.trim() || 'Opponent Team');
        });
    });

</script>

</body>
</html>
